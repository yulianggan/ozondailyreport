# 按周模式实现计划（方案1：单一接口扩展）

上下文：
- 新增“按周展示模式”，自然周（周一~周日），给定选择日与周数 N，第 N 周为包含选择日的自然周；向前 N-1 周分段；页面与导出按周汇总展示。
- 后端：FastAPI，MongoDB（宿主机）；前端：静态 React（public/index.html）。

实施步骤：
1) 模型与工具
   - backend/app/models.py：DayMetrics.date 支持 str；ReportResponse 增加 mode、period_labels。
   - backend/app/utils.py：新增 iso_week_bounds(), build_weeks() 构造自然周范围。

2) /api/report 扩展
   - 新增参数 mode(day|week)、weeks。
   - day：保持现有逻辑。
   - week：构造周段列表，查询最早周起~最后周末；按周聚合（销量/广告销量/自然销量/销售额/均价(加权)/成本/销售成本/广告费/回款/利润/库存/广告占比）；返回 period_labels 与 rows[*].days（一列一周）。左侧汇总区返回近N周汇总（复用 summary_12d 字段名）。

3) 调试接口
   - /api/debug-report 支持 mode、weeks，返回最终过滤器与命中数。

4) 前端
   - 工具栏新增“展示模式：日/周”和“展示周数”。
   - 请求附带 mode 与 days|weeks；表头“第i周\nYYYY-MM-DD ~ YYYY-MM-DD”。
   - 左侧文案：汇总销量/销售额/广告占比。
   - 导出：两种导出在周模式下使用“周一列”的宽表和每周一行的明细表。

验证：
- /api/debug-report?mode=week&date=YYYY-MM-DD&weeks=12&platform=ozon => total_match>0。
- 前端切换周模式，渲染正确且导出包含“第i周+周范围”。

